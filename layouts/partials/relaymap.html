<% if @item[:map] %>
<style>
  #map {
    width:  100%;
    height: 500px;
  }
</style>

<div id="map"></div>

<script>
var map = new google.maps.Map(d3.select("#map").node(),
                   {zoom: 7<% if @item[:gps_center] %>,
                    center: {<%= @item[:gps_center] %>}<% end %>
                    });
// add the data
map.data.loadGeoJson('<%= @item[:map] %>');

// set the boundaries
var southWest = new google.maps.LatLng(<%= @item[:gps_sw] %>);
var northEast = new google.maps.LatLng(<%= @item[:gps_ne] %>);
var bounds = new google.maps.LatLngBounds(southWest,northEast);
map.fitBounds(bounds);

// add listeners
map.data.addListener('click', function(event) {
  var url = "https://www.google.com/maps/preview/place/";
  if ( /(iPad|iPhone|iPod)/g.test( navigator.userAgent ) ) {
    url = "http://maps.apple.com/?q=";
  }
  url = url + event.latLng.toUrlValue();
  window.open(url);
});
map.data.addListener('mouseover', function(event) {
  //console.log(event);
  console.log(event.feature.j);
});
map.data.addListener('mouseout', function(event) {
  map.data.revertStyle();
});
</script>
<% end %>
